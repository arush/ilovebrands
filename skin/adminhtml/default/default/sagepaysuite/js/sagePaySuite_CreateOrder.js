if(typeof EbizmartsSagePaySuite=="undefined"){var EbizmartsSagePaySuite={}}EbizmartsSagePaySuite.AdminOrder=Class.create();EbizmartsSagePaySuite.AdminOrder.prototype={initialize:function(a){this.config=a;this.servercode="sagepayserver_moto";this.directcode="sagepaydirectpro_moto";Event.observe(window,"load",function(){$(editForm.formId).writeAttribute("action",SuiteConfig.getConfig("global","adminhtml_save_order_url"));document.body.insert(new Element("a",{id:"sagepayserver-dummy-link",href:"#",style:"display:none"}).update("&nbsp;"))})},evalTransport:function(transport){try{response=eval("("+transport.responseText+")")}catch(e){response={}}return response},getInstance:function(a){return this.config[a]},getPaymentMethod:function(){var b=$$("#order-billing_method_form [name='payment[method]']");for(var a=0;a<b.length;a++){if(b[a].checked){return b[a].value}}return null},isServerPaymentMethod:function(){return(this.getPaymentMethod()===this.servercode)},isDirectPaymentMethod:function(){return(this.getPaymentMethod()===this.directcode)},orderSave:function(){if(!this.isServerPaymentMethod()){order.submit();return}var a=$("edit_form").select("input","select","textarea");new Ajax.Request(SuiteConfig.getConfig("server","sgps_admin_registertrn_url"),{method:"post",parameters:$H(Form.serializeElements(a,true)),onSuccess:function(c){var b=this.evalTransport(c);if((typeof b.next_url)=="undefined"){alert(b.response_status_detail);return}$("sagepayserver-dummy-link").writeAttribute("href",b.next_url);new Control.Modal("sagepayserver-dummy-link",{className:"modal",closeOnClick:false,iframe:true,height:SuiteConfig.getConfig("server","iframe_height"),width:SuiteConfig.getConfig("server","iframe_width"),fade:true}).open()}.bind(this)})}};