number_format=function(w,z,r,x){var A=w,B=z;var u=function(b,c){var a=Math.pow(10,c);return(Math.round(b*a)/a).toString()};A=!isFinite(+A)?0:+A;B=!isFinite(+B)?0:Math.abs(B);var i=(typeof x==="undefined")?",":x;var y=(typeof r==="undefined")?".":r;var n=(B>0)?u(A,B):u(Math.round(A),B);var q=u(Math.abs(A),B);var s,v;if(q>=1000){s=q.split(/\D/);v=s[0].length%3||3;s[0]=n.slice(0,v+(A<0))+s[0].slice(v).replace(/(\d{3})/g,i+"$1");n=s.join(y)}else{n=n.replace(".",y)}var t=n.indexOf(y);if(B>=1&&t!==-1&&(n.length-t-1)<B){n+=new Array(B-(n.length-t-1)).join(0)+"0"}else{if(B>=1&&t===-1){n+=y+new Array(B).join(0)+"0"}}return n};releasePayment=function(j,i,a){var b=$("amntToRelease");var h=b.getValue();if(b.visible()){if(confirm(Translator.translate("Are you sure?"))){new Ajax.Request(j,{method:"post",parameters:{orderID:i,usrname:a,amount:h},onSuccess:function(d){var c=d.responseText;if(c=="OK"){location.href=location.href}else{alert(c)}}})}}else{$("capture_payment_"+i).update(Translator.translate("Confirm Release"));b.show()}};abortPayment=function(f,b,a){if(confirm(Translator.translate("Are you sure?"))){new Ajax.Request(f,{method:"post",parameters:{orderID:b,usrname:a},onSuccess:function(d){var c=d.responseText;if(c=="OK"){location.href=location.href}else{alert(c)}}})}};voidPayment=function(f,b,a){if(confirm(Translator.translate("Are you sure?"))){new Ajax.Request(f,{method:"post",parameters:{orderID:b,usrname:a},onSuccess:function(d){var c=d.responseText;if(c=="OK"){location.href=location.href}else{alert(c)}}})}};cancelPayment=function(f,b,a){if(confirm(Translator.translate("Are you sure?"))){new Ajax.Request(f,{method:"post",parameters:{orderID:b,usrname:a},onSuccess:function(d){var c=d.responseText;if(c=="OK"){location.href=location.href}else{alert(c)}}})}};authorisePayment=function(j,i,a){var b=$("amntToAuthorise");var h=b.getValue();if(b.visible()){if(confirm(Translator.translate("Are you sure?"))){if(!parseFloat(h)){alert(Translator.translate("Please enter a valid value."));return}new Ajax.Request(j,{method:"post",parameters:{orderID:i,usrname:a,amount:h},onSuccess:function(d){var c=d.responseText;if(c=="OK"){location.href=location.href}else{alert(c)}}})}}else{$("authorise_payment_"+i).update(Translator.translate("Confirm Authorise"));b.show()}};refundPayment=function(n,m){var j=$("amntToRefund");var a=$("refundDescrTxtarea");var k=$("refund_type_id");var l=j.getValue();var b=a.getValue();if(j.visible()){if(confirm(Translator.translate("Are you sure?"))){if(!parseFloat(l)){alert(Translator.translate("Please enter a valid value to Refund."));return}new Ajax.Request(n,{method:"post",parameters:{orderID:m,amount:l,descr:b},onSuccess:function(d){var c=d.responseText;if(c=="OK"){location.href=location.href}else{alert(c)}}})}}else{$("refund_payment_"+m).update(Translator.translate("Confirm Refund"));j.show();j.adjacent("label")[0].show();j.ancestors()[0].show();k.show();k.adjacent("label")[0].show();k.ancestors()[0].show();a.show();a.adjacent("label")[0].show();a.ancestors()[0].show()}};obsRefundChange=function(f){var d=this.getValue();var e=$("amntToRefund");switch(d){case"mn":e.writeAttribute("value","");break;case"ot":e.writeAttribute("value",number_format(TOTAL_ORDER_AMOUNT,2,".",""));break;case"ot-sh":e.writeAttribute("value",number_format(SUB_TOTAL_ORDER_AMOUNT,2,".",""));break}};repeatPayment=function(b,a,l){var q=$("amntToRepeat");var m=$("repeatDescrTxtarea");var o=$("currency_type_id");var p=q.getValue();var n=m.getValue();var r=o.getValue();if(q.visible()){if(confirm(Translator.translate("Are you sure?"))){if(!parseFloat(p)){alert(Translator.translate("Please enter a valid value."));return}new Ajax.Request(b,{method:"post",parameters:{orderID:a,usrname:l,amount:p,descr:n,currncy:r,trnreptype:"REPEAT"},onSuccess:function(d){var c=d.responseText;if(c=="OK"){location.href=location.href}else{alert(c)}}})}}else{$("repeat_payment_"+a).update(Translator.translate("Confirm Repeat"));q.show();q.adjacent("label")[0].show();q.ancestors()[0].show();m.show();m.adjacent("label")[0].show();m.ancestors()[0].show();o.show();o.adjacent("label")[0].show();o.ancestors()[0].show()}};Event.observe(window,"load",function(){var b=$("refund_type_id");if(b){Event.observe(b,"change",obsRefundChange)}});closeModalWindow=function(){parent.Control.Window.windows.each(function(a){if(a.container.visible()){a.close()}})};colorResults=function(){var a=$$("ul#card-checks");if(a.length>0){a[0].childElements().each(function(b){var c=b.select("span")[0];switch(c.innerHTML){case"MATCHED":c.setStyle({color:"#0F8F08"});break;case"NOTMATCHED":c.setStyle({color:"#EF0E0E"});break;case"NOTPROVIDED":c.setStyle({color:"#9F9F9F"});case"NOTCHECKED":case"DATA NOT CHECKED":case"SECURITY CODE MATCH ONLY":c.setStyle({color:"#EF8100"});break;default:break}})}};logSelectObserve=function(){var a=$("sl-log-switcher");if(a){a.observe("change",function(b){$("sagepaysuite-log-view").src=a.getValue()})}};loadActions=function(){colorResults();logSelectObserve()};Event.observe(window,"load",loadActions);var varienGridAction={execute:function(b){if(!b.value||!b.value.isJSON()){return}var d=b.value.evalJSON();if(d.confirm&&!window.confirm(d.confirm)){b.options[0].selected=true;return}if(d.popup){if(d.modal){try{var a=new Element("div",{className:"lcontainer"});var f=new Control.Modal(d.href,{className:"modal",iframe:true,insertRemoteContentAt:a,height:"800",width:"1100",fade:true});f.container.insert(a);f.open()}catch(c){}}else{var e=window.open(d.href,"action_window","width=500,height=600,resizable=1,scrollbars=1");e.focus()}b.options[0].selected=true}else{setLocation(d.href)}}};var orphansGridMassaction=Class.create(varienGridMassaction,{onGridRowClick:function(a,h){var b=Event.findElement(h,"td");var d=Event.findElement(h,"tr");if(!$(b).down("input")){if($(b).down("a")||$(b).down("select")){return}if(d.title){try{var j=new Element("div",{className:"lcontainer"});var i=new Control.Modal(d.title,{className:"modal",iframe:true,insertRemoteContentAt:j,height:"800",width:"1100",fade:true});i.container.insert(j);i.open()}catch(e){setLocation(d.title)}}else{var c=Element.select(d,"input");var f=Event.element(h).tagName=="input";var g=f?c[0].checked:!c[0].checked;if(g){this.checkedString=varienStringArray.add(c[0].value,this.checkedString)}else{this.checkedString=varienStringArray.remove(c[0].value,this.checkedString)}this.grid.setCheckboxChecked(c[0],g);this.updateCount()}return}if(Event.element(h).isMassactionCheckbox){this.setCheckbox(Event.element(h))}else{if(c=this.findCheckbox(h)){c.checked=!c.checked;this.setCheckbox(c)}}}});