tokenSetDefault=function(a){new Ajax.Request((BLANK_URL.replace("js/blank.html","sgps/card/default")),{method:"get",parameters:{card:a.value},onSuccess:function(c){var b=c.responseText.evalJSON();if(b.st!="ok"){alert(b.text)}$("sageTokenCardLoading").hide()},onLoading:function(){$("sageTokenCardLoading").show()}})};evenOdd=function(c,b){var a=((b+1)%2==0?"even":"odd");c.addClassName(a)};updateEvenOdd=function(){var a=$$("table#my-sagepaycards-table tbody tr");a.invoke("removeClassName","odd").invoke("removeClassName","even");a.each(function(c,b){evenOdd(c,b)})};postRegisterCard=function(b){var a=new Validation(b);if(!a.validate()){return}b.request({onComplete:function(d){var c=d.responseText.evalJSON();if(c.status!="OK"){alert(c.status.toString()+" -> "+c.statusdetail.toString())}else{var e=new Template('<tr><td>#{cctype}</td><td>#{ccnumber}</td><td>#{exp}</td><td class="a-center"><input#{defaultchecked} type="radio" value="#{id}" name="tokencard_def" onclick="tokenSetDefault(this);" /></td><td class="last"><a href="#{delurl}" onclick="if(confirm(\''+Translator.translate("Are you sure?")+"')){removeCard(this); return false; }else{return false;}\">"+Translator.translate("Delete")+"</a></td></tr>");new Insertion.Before($$("table#my-sagepaycards-table tbody tr")[0],e.evaluate(c.mark));if($("no-tokencards-tr")){$("no-tokencards-tr").up().remove()}$("frmRegCard").remove();updateEvenOdd()}$("sageTokenCardLoading").hide()},onLoading:function(){$("sageTokenCardLoading").show()}})};removeCard=function(a){var b=a.hasClassName("oncheckout");new Ajax.Request(a.href,{method:"get",onSuccess:function(e){try{var c=e.responseText.evalJSON();if(c.st!="ok"){alert(c.text)}else{if(false===b){a.up().up().fade({afterFinish:function(){a.up().up().remove();updateEvenOdd()}})}else{a.up().fade({afterFinish:function(){a.up().remove()}})}}if(!b){$("sageTokenCardLoading").hide()}}catch(d){alert(d)}},onLoading:function(){if(!b){if($("iframeRegCard")){$("iframeRegCard").remove()}else{if($("frmRegCard")){$("frmRegCard").remove()}}$("sageTokenCardLoading").show()}}})};registerCard=function(a){new Ajax.Request(a,{method:"get",onSuccess:function(c){var b=c.responseText.evalJSON();if(b.url=="ERROR"){alert(b.text)}else{new Insertion.After("link-regcard",b.text)}$("sageTokenCardLoading").hide()},onLoading:function(){if($("iframeRegCard")){$("iframeRegCard").remove()}else{if($("frmRegCard")){$("frmRegCard").remove()}}$("sageTokenCardLoading").show()}})};